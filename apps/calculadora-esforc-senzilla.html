<!doctype html>
<html lang="ca">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Calculadora d'Esfor√ß ‚Äî Versi√≥ Senzilla</title>
<style>
/* ================================
   üåà PALETA (NO CANVIAR)
   ================================ */
:root{
  --bg-top:#0b1226;              /* Fons principal: gradient vertical */
  --bg-bottom:#0f172a;
  --card: rgba(17,24,39,.75);    /* Targetes/cards */
  --border: rgba(148,163,184,.15); /* Contorns i divis√≤ries */
  --border-strong: rgba(148,163,184,.30);
  --text:#e5e7eb;                /* Text principal */
  --muted:#94a3b8;               /* Text secundari/muted */
  --accent:#38bdf8;              /* Accent primari (UI, sliders, icones) */
  --grad-a:#38bdf8;              /* Gradient destacat en visuals */
  --grad-b:#a78bfa;
  --error:#ef4444;               /* Errors validaci√≥ */
  --card-radius:16px;
  --btn-radius:12px;
  --input-radius:10px;
  --shadow:0 10px 30px rgba(0,0,0,.35), inset 0 1px 0 rgba(255,255,255,.03);
  --transition:300ms cubic-bezier(.22,1,.36,1); /* easeOutCubic */
}

/* ================================
   üÖ∞Ô∏è TIPOGRAFIA (NO CANVIAR)
   ================================ */
html,body{
  height:100%;
  background: linear-gradient(to bottom, var(--bg-top), var(--bg-bottom));
  color: var(--text);
  font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial, "Noto Sans";
}
body{ margin:0; }
code, .mono{
  font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New";
}

/* ================================
   üìê LAYOUT I TARGETA
   ================================ */
.container{ max-width:960px; margin:0 auto; padding:24px; }
.card{
  background: var(--card);
  border:1px solid var(--border);
  border-radius: var(--card-radius);
  box-shadow: var(--shadow);
  backdrop-filter: blur(6px);
  -webkit-backdrop-filter: blur(6px);
  padding:24px;
}
h1{
  font-weight:700;
  margin:0 0 10px 0;
  font-size: clamp(22px, 2.8vw, 32px); /* (NO CANVIAR) */
  letter-spacing:.2px;
}
.subtle{ color: var(--muted); font-size:1rem; }

/* ================================
   üëÜ COMPONENTS B√ÄSICS (SIEI)
   ================================ */
.row{ display:grid; gap:16px; }
@media (min-width:760px){
  .row.cols-2{ grid-template-columns: 1fr 1fr; }
  .row.cols-3{ grid-template-columns: 1fr 1fr 1fr; }
}
.block{ background:#0f172a; border:1px solid var(--border-strong); border-radius:12px; padding:14px; }
label{ color:var(--muted); font-size:.95rem; }

.segmented{
  display:inline-grid; grid-auto-flow:column; gap:8px;
  background:#0f172a; padding:6px; border-radius:999px; border:1px solid var(--border-strong);
}
.segmented input{ display:none; }
.segmented label{
  cursor:pointer; padding:10px 16px; border-radius:999px;
  color:var(--muted); user-select:none;
  transition: background var(--transition), color var(--transition), transform var(--transition);
}
.segmented input:checked + label{
  background: var(--accent); color:#0b1226; font-weight:700; transform: translateY(-1px);
}

/* Botons ‚Äúxip‚Äù de valors grans (per reduir c√†rrega cognitiva) */
.chips{ display:flex; flex-wrap:wrap; gap:10px; }
.chip{
  background:#0f172a; border:1px solid var(--border-strong);
  padding:10px 14px; border-radius:999px; cursor:pointer;
  transition: transform var(--transition), box-shadow var(--transition), border-color var(--transition);
}
.chip[aria-pressed="true"]{ border-color: var(--accent); box-shadow:0 0 0 3px rgba(56,189,248,.15); transform:translateY(-1px); }
.chip .mono{ font-weight:700; }

/* Select senzill (mant√© estil) */
select{
  width:100%; background:#0f172a; color:var(--text);
  border:1px solid var(--border-strong); border-radius:var(--input-radius); padding:10px 12px;
  transition:border-color var(--transition), transform var(--transition), box-shadow var(--transition);
}
select:focus{ border-color:var(--accent); box-shadow:0 0 0 3px rgba(56,189,248,.15); transform: translateY(-1px); }

input[type="range"]{ width:100%; accent-color: var(--accent); }

/* ================================
   üßÆ STATS GRID
   ================================ */
.stats{ display:grid; gap:12px; }
@media (min-width:760px){ .stats{ grid-template-columns: repeat(4, 1fr); } }
.stat{ background:#0f172a; border:1px solid var(--border); border-radius:12px; padding:12px; }
.k{ font-size:12px; color:var(--muted); }
.v{ font-size:18px; font-weight:800; }
.v.mono{ letter-spacing:.3px; }

/* ================================
   üîò BOTONS D'ACCI√ì
   ================================ */
.btn{
  background: var(--accent); color:#0b1226; border:none; font-weight:700;
  border-radius: var(--btn-radius); padding:12px 16px; cursor:pointer;
  transition: transform var(--transition), box-shadow var(--transition), opacity var(--transition);
}
.btn:disabled{ opacity:.5; cursor:not-allowed; }
.btn:hover{ transform: translateY(-1px); box-shadow:0 10px 20px rgba(56,189,248,.2); }

/* ================================
   ‚ö†Ô∏è VALIDACI√ì
   ================================ */
.error{ color:var(--error); font-size:.95rem; min-height:1.1em; }

/* ================================
   üìä FORMULES & VISUALS
   ================================ */
.formula{
  background:#0f172a; border:1px dashed var(--border-strong);
  border-radius:12px; padding:12px; font-size:1rem;
}
.formula .big{ display:block; font-size:1.05rem; margin-bottom:6px; }
.formula .sub{ color:var(--muted); font-size:.92rem; }

/* SVG responsiu de la biga (comparativa) */
.visual{
  width:100%; height:220px; border:1px solid var(--border); border-radius:12px;
  background: linear-gradient(180deg, rgba(56,189,248,.05), rgba(167,139,250,.04));
  overflow:hidden; position:relative;
}
.legend{ position:absolute; right:10px; top:10px; display:flex; gap:12px; align-items:center; font-size:.85rem; color:var(--muted); }
.legend span{ display:flex; gap:6px; align-items:center; }
.bullet{ width:16px; height:6px; border-radius:999px; }
.bullet.grad{ background: linear-gradient(90deg, var(--grad-a), var(--grad-b)); }
.bullet.ref{ background: repeating-linear-gradient(90deg, rgba(229,231,235,.7) 0 6px, rgba(229,231,235,0) 6px 12px); }

/* Peu de p√†gina (NO MODIFICAR TEXT) */
footer{ margin-top:18px; text-align:center; color:var(--muted); font-size:.9rem; }

/* ================================
   üåÄ MICRO-ANIMACIONS (300 ms)
   ================================ */
.hide{ display:none; }
.stepper{ display:grid; gap:14px; }
.step-head{ font-weight:700; }
.small{ font-size:.92rem; color:var(--muted); }
</style>
</head>
<body>
  <main class="container" role="main">
    <section class="card" aria-labelledby="titol">
      <h1 id="titol">Calculadora d'esfor√ß ‚Äî versi√≥ senzilla (SIEI)</h1>
      <p class="subtle">Passos curts i valors tancats. Tria i comprova. Xifres en format <span class="mono">ca-ES</span>.</p>

      <!-- ===============================
           üß≠ PAS A PAS (3 pantalles curtes)
           =============================== -->
      <div id="wizard" class="stepper" aria-live="polite">
        <!-- PAS 1: Tipus + Material (opci√≥ curta) -->
        <div class="block">
          <div class="step-head">1) Tipus d'esfor√ß i material</div>
          <div class="row cols-2">
            <div>
              <label class="small">Tipus d'esfor√ß</label>
              <div class="segmented" role="tablist" aria-label="Tria el tipus d'esfor√ß">
                <input type="radio" name="mode" id="modeT" value="traccio" checked>
                <label for="modeT">Tracci√≥</label>
                <input type="radio" name="mode" id="modeC" value="compressio">
                <label for="modeC">Compressi√≥</label>
              </div>
              <div class="small" style="margin-top:6px">Tracci√≥ <em>estira</em>, compressi√≥ <em>escur√ßa</em> la pe√ßa.</div>
            </div>
            <div>
              <label class="small">Material (E)</label>
              <div class="segmented" role="tablist" aria-label="Tria material">
                <input type="radio" name="mat" id="matAcer" value="200000" checked>
                <label for="matAcer">Acer (200.000)</label>
                <input type="radio" name="mat" id="matAl" value="70000">
                <label for="matAl">Alumini (70.000)</label>
              </div>
              <details style="margin-top:8px">
                <summary class="small">M√©s materials</summary>
                <select id="materialExtra" aria-label="Materials addicionals">
                  <option value="">‚Äî (no afegir)</option>
                  <option value="11000">Fusta (11.000)</option>
                  <option value="3500">Pl√†stic t√®cnic (3.500)</option>
                </select>
              </details>
            </div>
          </div>
        </div>

        <!-- PAS 2: Secci√≥, Longitud i For√ßa amb xips -->
        <div class="block">
          <div class="step-head">2) Dimensions i for√ßa</div>
          <div class="row cols-3">
            <div>
              <label class="small">Secci√≥ A (mm¬≤)</label>
              <div class="chips" role="group" aria-label="Tria la secci√≥">
                <button class="chip" data-a="100" aria-pressed="false"><span class="mono">100</span></button>
                <button class="chip" data-a="250" aria-pressed="true"><span class="mono">250</span></button>
                <button class="chip" data-a="500" aria-pressed="false"><span class="mono">500</span></button>
              </div>
              <div class="small" style="margin-top:6px">Secci√≥ m√©s gran ‚Üí menys tensi√≥.</div>
            </div>
            <div>
              <label class="small">Longitud L (mm)</label>
              <div class="segmented" role="tablist" aria-label="Tria la longitud">
                <input type="radio" name="L" id="L200" value="200">
                <label for="L200">200</label>
                <input type="radio" name="L" id="L300" value="300" checked>
                <label for="L300">300</label>
                <input type="radio" name="L" id="L400" value="400">
                <label for="L400">400</label>
              </div>
            </div>
            <div>
              <label class="small">L√≠mit admissible œÉ<sub>adm</sub> (MPa)</label>
              <div class="segmented" role="tablist" aria-label="Tria l√≠mit admissible">
                <input type="radio" name="adm" id="adm80" value="80">
                <label for="adm80">80</label>
                <input type="radio" name="adm" id="adm120" value="120" checked>
                <label for="adm120">120</label>
                <input type="radio" name="adm" id="adm160" value="160">
                <label for="adm160">160</label>
              </div>
            </div>
          </div>

          <div class="row cols-2" style="margin-top:10px;">
            <div>
              <label class="small">For√ßa F (N) ‚Äî tria un bot√≥</label>
              <div class="chips" role="group" aria-label="Tria la for√ßa">
                <button class="chip" data-f="250" aria-pressed="false"><span class="mono">250</span></button>
                <button class="chip" data-f="500" aria-pressed="false"><span class="mono">500</span></button>
                <button class="chip" data-f="1000" aria-pressed="true"><span class="mono">1.000</span></button>
                <button class="chip" data-f="2000" aria-pressed="false"><span class="mono">2.000</span></button>
                <button class="chip" data-f="5000" aria-pressed="false"><span class="mono">5.000</span></button>
              </div>
              <div style="margin-top:8px">
                <input id="forcaRange" type="range" min="0" max="50000" step="250" value="1000" aria-label="For√ßa en Newtons (lliscant)">
                <div class="small">Tamb√© pots lliscar (0 ‚Üí 50.000 N)</div>
              </div>
              <div id="errorForca" class="error" aria-live="polite"></div>
            </div>
            <div>
              <label class="small">Escenaris r√†pids</label>
              <div class="chips" role="group" aria-label="Escenaris">
                <button class="chip" data-scn="lleu"><span>For√ßa lleu</span></button>
                <button class="chip" data-scn="mitja"><span>For√ßa mitjana</span></button>
                <button class="chip" data-scn="alta"><span>For√ßa alta</span></button>
              </div>
              <div class="small" style="margin-top:6px">Aplica valors t√≠pics per provar r√†pid.</div>
            </div>
          </div>
        </div>

        <!-- PAS 3: F√≥rmula, Visual i Resultat -->
        <div class="block">
          <div class="step-head">3) Resultat</div>
          <div class="formula" aria-live="polite">
            <span class="big">F√≥rmules clau</span>
            <div>1) <span class="mono">œÉ = F / A</span> <span class="sub">‚Üí Tensi√≥ (MPa) si F en N i A en mm¬≤ (1 N/mm¬≤ = 1 MPa)</span></div>
            <div>2) <span class="mono">ŒîL = F ¬∑ L / (A ¬∑ E)</span> <span class="sub">‚Üí Allargament/escur√ßament te√≤ric</span></div>
            <div>3) <span class="mono">Œµ = ŒîL / L</span> <span class="sub">‚Üí Deformaci√≥ (sense unitat)</span></div>
            <hr style="border:none;border-top:1px solid var(--border); margin:10px 0">
            <div id="substitucions" class="mono" aria-label="Substituci√≥ num√®rica pas a pas"></div>
          </div>

          <div class="visual" style="margin-top:12px;" aria-label="Visualitzaci√≥ de la biga">
            <div class="legend">
              <span><i class="bullet ref"></i> refer√®ncia</span>
              <span><i class="bullet grad"></i> pe√ßa deformada</span>
            </div>
            <svg id="svg" viewBox="0 0 900 220" preserveAspectRatio="xMidYMid meet" role="img" aria-label="Biga amb comparativa de deformaci√≥">
              <!-- Marca esquerra (fixa) -->
              <rect x="70" y="40" width="10" height="140" fill="rgba(229,231,235,.35)"/>
              <!-- Marca dreta (est√†tica de refer√®ncia) -->
              <rect id="rightRef" x="830" y="40" width="10" height="140" fill="rgba(229,231,235,.35)"/>
              <!-- Biga refer√®ncia (discont√≠nua) -->
              <line x1="80" y1="110" x2="830" y2="110"
                    stroke="rgba(229,231,235,.7)" stroke-width="10"
                    stroke-dasharray="16 10" />
              <!-- Biga deformada (gradient) -->
              <defs>
                <linearGradient id="barGrad" x1="0%" x2="100%">
                  <stop offset="0%" stop-color="var(--grad-a)"/>
                  <stop offset="100%" stop-color="var(--grad-b)"/>
                </linearGradient>
              </defs>
              <line id="bar" x1="80" y1="110" x2="830" y2="110"
                    stroke="url(#barGrad)" stroke-width="14" stroke-linecap="round"/>
              <!-- Fletxes for√ßa -->
              <g id="arrows"></g>
            </svg>
          </div>

          <div class="row" style="margin-top:12px;">
            <div class="stats" aria-live="polite">
              <div class="stat">
                <div class="k">Tensi√≥ œÉ (MPa)</div>
                <div id="outSigma" class="v mono">0</div>
              </div>
              <div class="stat">
                <div class="k">ŒîL (mm)</div>
                <div id="outDeltaL" class="v mono">0</div>
              </div>
              <div class="stat">
                <div class="k">Deformaci√≥ Œµ (‚Äî)</div>
                <div id="outEps" class="v mono">0</div>
              </div>
              <div class="stat">
                <div class="k">Seguretat (œÉ ‚â§ œÉ<sub>adm</sub>)</div>
                <div id="outSafe" class="v mono">‚Äî</div>
              </div>
            </div>
          </div>

          <div class="row cols-2" style="margin-top:12px; align-items:end;">
            <div>
              <label class="small">Escriu la teua substituci√≥ (opcional):</label>
              <input id="pasBuit" class="mono" type="text" placeholder="Ex.: œÉ = 1000 / 250 = 4 MPa"
                     style="width:100%; background:#0f172a; color:var(--text); border:1px solid var(--border-strong); border-radius:10px; padding:10px 12px;">
            </div>
            <div style="display:flex; gap:10px; justify-content:flex-end;">
              <button id="btnReset" class="btn" aria-label="Reinicia valors">Reinicia</button>
              <button id="btnCalc" class="btn" aria-label="Comprova">Comprova</button>
            </div>
          </div>
        </div>
      </div>

      <footer>Fet per Juan Arambul com a complement al tema d'Estructures i Esfor√ßos</footer>
    </section>
  </main>

<script>
/* ======================================================================
   üß† JS ‚Äî VERSI√ì SIEI
   - Valors tancats via xips i segmentats (reducci√≥ de decisions)
   - Sync discret del lliscant de for√ßa amb els xips
   - C√†lculs i visual SVG amb micro-animaci√≥ (300 ms, easeOutCubic)
   - Internacionalitzaci√≥ toLocaleString('ca-ES')
   ====================================================================== */

/* -----------------------------
   üîß Utilitats
------------------------------*/
const clamp = (v, a, b) => Math.min(Math.max(v, a), b);
const easeOutCubic = t => 1 - Math.pow(1 - t, 3);
const fmt = (x, d=3) => isFinite(x) ? Number(x).toLocaleString('ca-ES',{maximumFractionDigits:d}) : '‚Äî';

/* -----------------------------
   üìå Estat (valors actuals)
------------------------------*/
let state = {
  mode: 'traccio',
  E: 200000,       // MPa
  A: 250,          // mm¬≤
  L: 300,          // mm
  F: 1000,         // N
  sigAdm: 120      // MPa
};

/* -----------------------------
   üß© Selecci√≥ d'elements
------------------------------*/
const modeT = document.getElementById('modeT');
const modeC = document.getElementById('modeC');
const materialExtra = document.getElementById('materialExtra');

const chipA = [...document.querySelectorAll('.chip[data-a]')];
const chipF = [...document.querySelectorAll('.chip[data-f]')];
const chipsScn = [...document.querySelectorAll('.chip[data-scn]')];

const L200 = document.getElementById('L200');
const L300 = document.getElementById('L300');
const L400 = document.getElementById('L400');

const adm80 = document.getElementById('adm80');
const adm120 = document.getElementById('adm120');
const adm160 = document.getElementById('adm160');

const forcaRange = document.getElementById('forcaRange');
const errorForca = document.getElementById('errorForca');

const outSigma = document.getElementById('outSigma');
const outEps = document.getElementById('outEps');
const outDeltaL = document.getElementById('outDeltaL');
const outSafe = document.getElementById('outSafe');
const substitucions = document.getElementById('substitucions');

const btnCalc = document.getElementById('btnCalc');
const btnReset = document.getElementById('btnReset');

const svg = document.getElementById('svg');
const bar = document.getElementById('bar');
const rightRef = document.getElementById('rightRef');
const arrows = document.getElementById('arrows');

/* -----------------------------
   üîÅ L√≤gica de selecci√≥ senzilla
------------------------------*/
modeT.addEventListener('change', ()=>{ if(modeT.checked){ state.mode='traccio'; calc(); } });
modeC.addEventListener('change', ()=>{ if(modeC.checked){ state.mode='compressio'; calc(); } });

// Material curt (acer/alumini) amb override opcional de <select>
document.getElementById('matAcer').addEventListener('change', ()=>{
  if (document.getElementById('matAcer').checked){ state.E = 200000; materialExtra.value = ''; calc(); }
});
document.getElementById('matAl').addEventListener('change', ()=>{
  if (document.getElementById('matAl').checked){ state.E = 70000; materialExtra.value = ''; calc(); }
});
materialExtra.addEventListener('change', ()=>{
  const v = Number(materialExtra.value);
  if (v){ state.E = v; document.getElementById('matAcer').checked=false; document.getElementById('matAl').checked=false; }
  else{ state.E = document.getElementById('matAcer').checked ? 200000 : 70000; }
  calc();
});

// Secci√≥ A per xips
chipA.forEach(ch=>{
  ch.addEventListener('click', ()=>{
    chipA.forEach(x=>x.setAttribute('aria-pressed','false'));
    ch.setAttribute('aria-pressed','true');
    state.A = Number(ch.dataset.a);
    calc();
  });
});

// Longitud L segmentada
[L200,L300,L400].forEach(el=>{
  el.addEventListener('change', ()=>{
    if (el.checked){ state.L = Number(el.value); calc(); }
  });
});

// œÉadm segmentada
[adm80,adm120,adm160].forEach(el=>{
  el.addEventListener('change', ()=>{
    if (el.checked){ state.sigAdm = Number(el.value); calc(); }
  });
});

// For√ßa per xips + slider discret
chipF.forEach(ch=>{
  ch.addEventListener('click', ()=>{
    chipF.forEach(x=>x.setAttribute('aria-pressed','false'));
    ch.setAttribute('aria-pressed','true');
    state.F = Number(ch.dataset.f);
    forcaRange.value = state.F;
    calc();
  });
});

forcaRange.addEventListener('input', ()=>{
  const v = Number(forcaRange.value);
  state.F = v;
  // ajusta xips segons el valor m√©s proper
  let nearest = chipF.reduce((best, el)=>{
    const d = Math.abs(Number(el.dataset.f) - v);
    return d < best.d ? {el, d} : best;
  }, {el:null, d:Infinity}).el;
  chipF.forEach(x=>x.setAttribute('aria-pressed','false'));
  if (nearest) nearest.setAttribute('aria-pressed','true');
  calc();
});

// Escenaris r√†pids
chipsScn.forEach(ch=>{
  ch.addEventListener('click', ()=>{
    const scn = ch.dataset.scn;
    if (scn === 'lleu'){ state.F = 500; state.A = 500; state.L = 300; }
    if (scn === 'mitja'){ state.F = 2000; state.A = 250; state.L = 300; }
    if (scn === 'alta'){ state.F = 5000; state.A = 100; state.L = 300; }
    // reflecteix canvis a UI
    forcaRange.value = state.F;
    // xips F
    let fBtn = chipF.find(b=>Number(b.dataset.f)===state.F);
    chipF.forEach(x=>x.setAttribute('aria-pressed','false'));
    if (fBtn) fBtn.setAttribute('aria-pressed','true');
    // xips A
    let aBtn = chipA.find(b=>Number(b.dataset.a)===state.A);
    chipA.forEach(x=>x.setAttribute('aria-pressed','false'));
    if (aBtn) aBtn.setAttribute('aria-pressed','true');
    // L
    [L200,L300,L400].forEach(el=> el.checked = (Number(el.value)===state.L));
    calc();
  });
});

/* -----------------------------
   üßÆ C√†lculs (œÉ, ŒîL, Œµ) i substituci√≥
------------------------------*/
function calc(){
  errorForca.textContent = '';
  const {F,A,L,E,sigAdm} = state;

  if (F < 0 || F > 50000){
    errorForca.textContent = 'La for√ßa ha d‚Äôestar entre 0 i 50.000 N.';
    return;
  }

  const sigma = F / A;                // MPa (N/mm¬≤)
  const deltaL = (F * L) / (A * E);   // mm
  const eps = deltaL / L;             // ‚Äî

  substitucions.innerHTML =
    `œÉ = F / A = ${fmt(F,0)} / ${fmt(A,0)} = <b>${fmt(sigma,3)} MPa</b><br>` +
    `ŒîL = F¬∑L / (A¬∑E) = (${fmt(F,0)}¬∑${fmt(L,0)}) / (${fmt(A,0)}¬∑${fmt(E,0)}) = <b>${fmt(deltaL,4)} mm</b><br>` +
    `Œµ = ŒîL / L = ${fmt(deltaL,4)} / ${fmt(L,0)} = <b>${fmt(eps,6)}</b>`;

  outSigma.textContent = fmt(sigma,3);
  outDeltaL.textContent = fmt(deltaL,4);
  outEps.textContent = fmt(eps,6);
  outSafe.textContent = (sigma <= sigAdm) ? '‚úÖ Segur' : '‚ö†Ô∏è Supera l√≠mit';
  outSafe.style.color = (sigma <= sigAdm) ? '#22c55e' : '#ef4444';

  updateVisual(deltaL);
}

/* -----------------------------
   üéûÔ∏è Visual SVG amb micro-animaci√≥
------------------------------*/
let anim = { fromX2:830, toX2:830, start:0 };

function updateVisual(deltaL){
  const baseX1 = 80, baseX2 = 830;
  const mode = state.mode;

  const pxPerMm = 0.7;               // escala visual
  let dpx = clamp(deltaL * pxPerMm, -90, 90);
  if (mode === 'compressio') dpx *= -1;

  anim.fromX2 = Number(bar.getAttribute('x2')) || baseX2;
  anim.toX2 = baseX2 + dpx;
  anim.start = performance.now();

  drawArrows(mode, baseX1, baseX2 + dpx); // fletxes a posici√≥ actual
  requestAnimationFrame(step);
}

function step(ts){
  const dur = 300; // 300 ms
  const t = clamp((ts - anim.start)/dur, 0, 1);
  const k = easeOutCubic(t);
  const x = anim.fromX2 + (anim.toX2 - anim.fromX2)*k;
  bar.setAttribute('x1', 80);
  bar.setAttribute('x2', x);
  if (t < 1) requestAnimationFrame(step);
}

/* Fletxes de for√ßa coherents amb el mode */
function drawArrows(mode, x1, x2){
  const y = 110, len = 34, thick = 4;
  arrows.innerHTML = '';
  const g = document.createElementNS('http://www.w3.org/2000/svg','g');
  g.setAttribute('stroke', 'var(--accent)');
  g.setAttribute('stroke-width', thick);
  g.setAttribute('stroke-linecap', 'round');

  if (mode === 'traccio'){
    g.appendChild(line(x1, y, x1 - len, y));     // cap a fora (esquerra ‚Üê)
    g.appendChild(line(x2, y, x2 + len, y));     // cap a fora (dreta ‚Üí)
  }else{
    g.appendChild(line(x1 - len, y, x1, y));     // cap endins (‚Üí)
    g.appendChild(line(x2 + len, y, x2, y));     // cap endins (‚Üê)
  }
  arrows.appendChild(g);

  function line(x1,y1,x2,y2){
    const L = document.createElementNS('http://www.w3.org/2000/svg','line');
    L.setAttribute('x1', x1); L.setAttribute('y1', y1);
    L.setAttribute('x2', x2); L.setAttribute('y2', y2);
    return L;
  }
}

/* -----------------------------
   üîò Botons
------------------------------*/
btnCalc.addEventListener('click', calc);
btnReset.addEventListener('click', ()=>{
  // reinici senzill per a SIEI
  state = { mode:'traccio', E:200000, A:250, L:300, F:1000, sigAdm:120 };
  // UI
  modeT.checked = true; modeC.checked = false;
  document.getElementById('matAcer').checked = true; document.getElementById('matAl').checked = false; materialExtra.value = '';
  chipA.forEach(x=>x.setAttribute('aria-pressed','false'));
  chipA.find(b=>Number(b.dataset.a)===250).setAttribute('aria-pressed','true');
  chipF.forEach(x=>x.setAttribute('aria-pressed','false'));
  chipF.find(b=>Number(b.dataset.f)===1000).setAttribute('aria-pressed','true');
  forcaRange.value = 1000;
  [L200,L300,L400].forEach(el=> el.checked = (el===L300));
  [adm80,adm120,adm160].forEach(el=> el.checked = (el===adm120));
  document.getElementById('pasBuit').value = '';
  calc();
});

/* -----------------------------
   ‚ñ∂Ô∏è Inici
------------------------------*/
calc();
</script>
</body>
</html>
